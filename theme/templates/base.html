{% macro page_menu(pages, direction='vertical', include_ul=True, max_depth=10000) -%}
  {% if include_ul %}<ul class="menu {{ direction }}">{% endif %}
    {% for menu_page in pages|rejectattr('template', 'eq', 'tei-reader') %}
    <li {% if page and (menu_page == page or menu_page in page.parents) %}class="active"{% endif %}><a href="{{ SITEURL }}/{{ menu_page.url }}">{% if menu_page.menu_title %}{{ menu_page.menu_title }}{% else %}{{ menu_page.title }}{% endif %}</a>
        {% if menu_page.children|rejectattr('template', 'eq', 'tei-reader')|list|length > 0 and max_depth > 0 %}{{ page_menu(menu_page.children, direction='horizontal' if direction == 'vertical' else 'vertical', max_depth=max_depth - 1) }}{% endif %}
      </li>
    {% endfor %}
  {% if include_ul %}</ul>{% endif %}
{%- endmacro -%}
<!DOCTYPE html>
<html lang="{{ DEFAULT_LANG }}">
  <head>
    {% block head %}
      <meta charset="utf-8"/>
      <title>{% block title %}{{ SITETITLE }}{% endblock %}</title>
      <link rel="icon" href="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/images/favicon.ico" type="image/x-icon"/>
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <link rel="stylesheet" href="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/css/fonts.5b50a56749a08399519df8faacf954c3.css" />
      <link rel="stylesheet" href="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/css/app.cef0434c394e8edf31576accccadae5a.css" />
      {% if FEED_ALL_ATOM %}
        <link href="{{ FEED_DOMAIN }}/{{ FEED_ALL_ATOM }}" type="application/atom+xml" rel="alternate" title="{{ SITENAME }} Atom Feed" />
      {% endif %}
      {% if FEED_ALL_RSS %}
        <link href="{{ FEED_DOMAIN }}/{{ FEED_ALL_RSS }}" type="application/rss+xml" rel="alternate" title="{{ SITENAME }} RSS Feed" />
      {% endif %}
      <script src="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/js/jquery.min.js"></script>
      <script src="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/js/what-input.min.js"></script>
      {% block head_scripts %}{% endblock %}
    {% endblock %}
  </head>
  <body>
    <div class="title-bar" data-responsive-toggle="main-nav" data-hide-for="medium">
      <button class="menu-icon" type="button" data-toggle></button>
      <div class="title-bar-title">Menu</div>
    </div>
    <header id="main-nav">
      <div class="top-bar">
        <nav class="top-bar-left">
          <ul class="menu dropdown" data-dropdown-menu="">
            <li {% if output_file == 'index.html' %}class="active"{% endif %}><a href="{{ SITEURL }}">{{ SITENAME }}<small class="show-for-medium">{{ SITETAGLINE }}</small></a></li>
            {% for title, link in MENUITEMS %}
              <li><a href="{{ link }}">{{ title }}</a></li>
            {% endfor %}
          </ul>
          <ul class="menu dropdown" data-dropdown-menu="">
            {{ page_menu(pages|selectattr('parent', 'none')|rejectattr('no_menu'), direction='horizontal', include_ul=False, max_depth=1) }}
          </ul>
        </nav>
        <nav class="top-bar-right">
          <ul class="menu dropdown" data-dropdown-menu="">
            <li class="menu-text show-for-xlarge"><img src="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/images/gutzkow-head.jpg" alt="Porträt Karl Gutzkow"/></li>
          </ul>
        </nav>
      </div>
    </header>
    <header id="medium-overlay-nav">
      <div class="top-bar">
        <nav class="top-bar-left">
          <ul class="menu dropdown" data-dropdown-menu="">
            <li {% if output_file == 'index.html' %}class="active"{% endif %}><a href="{{ SITEURL }}">{{ SITENAME }}<small>{{ SITETAGLINE }}</small></a></li>
            {% for title, link in MENUITEMS %}
              <li><a href="{{ link }}">{{ title }}</a></li>
            {% endfor %}
          </ul>
          <ul class="menu dropdown" data-dropdown-menu="">
            {{ page_menu(pages|selectattr('parent', 'none')|rejectattr('no_menu'), direction='horizontal', include_ul=False, max_depth=1) }}
          </ul>
        </nav>
        <nav class="top-bar-right">
          <ul class="menu dropdown" data-dropdown-menu="">
            <li class="menu-text show-for-xlarge"><img src="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/images/gutzkow-head.jpg" alt="Porträt Karl Gutzkow"/></li>
          </ul>
        </nav>
      </div>
    </header>
    <article class="grid-container">
      {% block content %}
      {% endblock %}
    </article>
    <footer class="grid-x grid-padding-x">
      <div class="cell small-12">
        <h2><a href="{{ SITEURL }}/pages/impressum.html">Impressum</a></h2>
        <h2><a href="{{ SITEURL }}/pages/datenschutzerklaerung.html">Datenschutzerklärung</a></h2>
        {% if LINKS %}
          <nav>
            <ul class="menu vertical">
              {% for name, link in LINKS %}
                <li><a href="{{ link }}" target="_blank" rel="noopener">{{ name }}</a></li>
              {% endfor %}
            </ul>
          </nav>
        {% endif %}
        <p>Zuletzt aktualisiert: <a href="https://gitlab.informatik.uni-halle.de/gutzkow/digitale-gesamtausgabe/commit/{{ GENERATION_CHANGE }}" target="_blank" rel="noopener">{{ GENERATION_DATE | strftime('%d.%m.%Y %H:%M')}}</a></p>
    </footer>
    <script src="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/js/foundation.min.js"></script>
    <script>$(document).foundation();</script>
    <script src="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/js/app.7891a6031bc10f47035f319efdbddb2f.js"></script>
    <script>
      const html = document.querySelector('html');
      const body = document.querySelector('body');
      const baseHeader = document.querySelector('#main-nav');
      window.addEventListener('scroll', function(ev) {
          if (html.scrollTop <= baseHeader.clientHeight) {
              body.classList.remove('scrolling');
          } else {
              body.classList.add('scrolling');
          }
      });
    </script>
    {% block body_scripts %}{% endblock body_scripts %}
  </body>
</html>
